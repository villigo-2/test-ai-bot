## Code Conventions (для генерации кода ассистентом)

- Источник истины: см. @vision.md. Если что-то не описано здесь — руководствоваться @vision.md.

### Общие принципы
- KISS и MVP-first: делать только необходимый минимум для ценности. Без оверинжиниринга. См. @vision.md.
- Один сервис, один процесс, монолит. Никаких фоновых очередей/микросервисов на MVP. См. @vision.md.
- Не добавлять зависимости вне утверждённого стека. См. @vision.md.

### Технологии и структура
- Использовать утверждённый стек и структуру каталогов/модулей из @vision.md.
- Публичные функции модулей соответствуют описанию в @vision.md; не расширять API без необходимости.
- История диалога только in‑memory (`dict`/`list`), без БД/персистентности. См. @vision.md.

### Код‑стайл и качество
- Писать ясный, простой код: маленькие функции, ранние возвраты, без глубокой вложенности.
- Именования — понятные и полные, без аббревиатур. Типы и контракты — очевидные из сигнатур.
- Никаких `print`; только `logging` с уровнем по умолчанию `INFO`. См. @vision.md.
- Критические unit‑тесты для аналитики/прогноза через `pytest`. Не покрывать всё — только важное. См. @vision.md.

### Ошибки и устойчивость
- На границах с внешними системами — `try/except`, дружелюбные ответы пользователю. См. @vision.md.
- Таймаут + один ретрай с небольшим бэкофом для LLM. При 2 подряд сбоях — короткий fallback‑ответ. См. @vision.md.

### Работа с LLM
- Использовать OpenRouter через OpenAI‑совместимый клиент. Модель и ключ из ENV. См. @vision.md.
- Промпт формируется из системного промпта + фактов (метрики/прогноз). Вывод — краткий текст, без галлюцинаций. См. @vision.md.
- Контекст — текущий запрос и короткая история (усечение по лимиту токенов). См. @vision.md.

### Конфигурация и секреты
- Только ENV. В репозитории — `.env.example`. Значимые переменные валидируются на старте. См. @vision.md.

### Логирование
- Формат и уровень — как в @vision.md. Логи в stdout/stderr. Без PII и без утечки секретов. Ключевые поля включать в сообщение.

### Деплой
- Один Docker‑контейнер, long polling. Управление через `Makefile`. См. @vision.md.


