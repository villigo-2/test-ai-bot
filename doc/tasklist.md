## Итерационный план разработки (MVP, KISS)

См. @vision.md и @conventions.md. Детали продукта — @product_idea.md.

### Прогресс (обновляется после каждой итерации)
- Выполнено: 0/10 → 1/10 → 2/10 → 3/10 → 4/10 → 5/10 → 6/10 → 7/10 → 8/10 → 9/10
- Журнал: Итерация 1 — согласован скелет бота (ENV, /start, /help, long polling); Итерация 2 — разбор ввода и маппинг стран; Итерация 3 — подключение Google Trends и вывод количества точек/диапазона; Итерация 4 — базовые метрики; Итерация 5 — простой прогноз; Итерация 6 — PNG-график тренда; Итерация 7 — LLM-резюме; Итерация 8 — in-memory история; Итерация 9 — изменение периода

### Итерации (каждая даёт тестируемый результат)
- [x] Итерация 1: Базовый бот (скелет)
  - Запуск `aiogram` (long polling), команды `/start`, `/help`, чтение ENV
  - Тест: отправить `/start` → получить приветствие и краткую инструкцию

- [x] Итерация 2: Разбор пользовательского ввода
  - Парсинг «термин; период; страна», валидация, маппинг страны на ISO
  - Тест: «chatgpt; 12m; Казахстан» → вернуть разобранные параметры

- [x] Итерация 3: Интеграция Google Trends
  - `trends_client.fetch_interest_over_time` (query, geo, timeframe) + обработка ошибок
  - Тест: запрос с валидными параметрами → вернуть кол-во точек и даты диапазона

- [x] Итерация 4: Базовые метрики
  - `analysis.compute_metrics`: mean/median/min/max/std, тренд, пики/сезонность (hint)
  - Тест: по полученному ряду вернуть краткий текст с метриками

- [x] Итерация 5: Простой прогноз
  - `analysis.compute_simple_forecast` (наивный/линейный), короткий горизонт, note об ограничениях
  - Тест: отдать прогноз на N точек и показать метод

- [x] Итерация 6: График тренда (PNG)
  - `plot.render_trend_plot`: ряд (+опц. прогноз), один PNG
  - Тест: бот присылает изображение графика

- [x] Итерация 7: Краткое объяснение через LLM
  - `llm_client.summarize`: факты (метрики/прогноз) → лаконичный вывод; таймаут + 1 ретрай; fallback
  - Тест: получить осмысленный краткий текст; при сбое — шаблонный ответ

- [x] Итерация 8: История диалога (in-memory)
  - `bot/state`: `dict[chat_id] -> list[message]`, усечение истории; локаль RU/EN
  - Тест: второе сообщение использует краткий контекст (без БД)

- [x] Итерация 9: Изменение периода
  - Повторный анализ при присланном новом периоде (без сравнения терминов)
  - Тест: отправить «30d» после предыдущего запроса → получить обновлённые метрики/график/текст

- [ ] Итерация 10: Docker + минимальный мониторинг LLM
  - `Dockerfile`, цели `make docker-build`/`docker-run`; логирование в stdout; сэмплирование 1 из N промптов в файл
  - Тест: бот работает из контейнера; в логах видны тайминги и счётчики

— План краткий и подлежит уточнению по мере выполнения. Все детали и решения см. в @vision.md и @conventions.md.


